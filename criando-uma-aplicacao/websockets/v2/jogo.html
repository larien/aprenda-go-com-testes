<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vamos jogar pôquer</title>
</head>
<corpo>
<section id="partida">
    <div id="partida-start">
        <label for="jogador-count">Number of jogadores</label>
        <input type="number" id="jogador-count"/>
        <button id="start-partida">Começar</button>
    </div>

    <div id="declare-vencedor">
        <label for="vencedor">Winner</label>
        <input type="text" id="vencedor"/>
        <button id="vencedor-button">Declare vencedor</button>
    </div>

    <div id="blind-value"/>
</section>

<section id="partida-end">
    <h1>Another great partida of poquer everyone!</h1>
    <p><a href="/liga">Go check the liga table</a></p>
</section>

</corpo>
<script type="application/javascript">
    const startGame = document.getElementById('partida-start')

    const declareWinner = document.getElementById('declare-vencedor')
    const submitWinnerButton = document.getElementById('vencedor-button')
    const winnerInput = document.getElementById('vencedor')

    const blindContainer = document.getElementById('blind-value')

    const gameContainer = document.getElementById('partida')
    const gameEndContainer = document.getElementById('partida-end')

    declareWinner.hidden = true
    gameEndContainer.hidden = true

    document.getElementById('start-partida').addEventListener('click', event => {
        startGame.hidden = true
        declareWinner.hidden = false

        const numeroDeJogadores = document.getElementById('jogador-count').value

        if (window['WebSocket']) {
            const conexão = new WebSocket('ws://' + document.location.host + '/ws')

            submitWinnerButton.onclick = event => {
                conexão.send(winnerInput.value)
                gameEndContainer.hidden = false
                gameContainer.hidden = true
            }

            conexão.onclose = evt => {
                blindContainer.innerText = 'Connection closed'
            }

            conexão.onmessage = evt => {
                blindContainer.innerText = evt.data
            }

            conexão.onopen = function () {
                conexão.send(numeroDeJogadores)
            }
        }
    })
</script>
</html>
